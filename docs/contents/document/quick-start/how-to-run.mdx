---
id: how-to-run
title: How to Run
sidebar_position: 3
---

```mdx-code-block
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
```

# Run abe-kafka

This guide shows how to run the abe-kafka backend locally for quick validation and testing.

## 1) Configure environment

Minimal configuration (PLAINTEXT):

```bash
export MESSAGE_QUEUE_BACKEND=kafka
export KAFKA_BOOTSTRAP_SERVERS=localhost:9092
```

SASL/PLAIN example:

```bash
export KAFKA_SECURITY_PROTOCOL=SASL_PLAINTEXT
export KAFKA_SASL_MECHANISM=PLAIN
export KAFKA_SASL_USERNAME=my-user
export KAFKA_SASL_PASSWORD=my-pass
```

SSL example:

```bash
export KAFKA_SECURITY_PROTOCOL=SSL
export KAFKA_SSL_CAFILE=/etc/ssl/ca.pem
export KAFKA_SSL_CERTFILE=/etc/ssl/cert.pem
export KAFKA_SSL_KEYFILE=/etc/ssl/key.pem
```

## 2) Publish and consume sample

```python
import asyncio
from abe_plugin.backends.message_queue.service.abe_kafka import KafkaMessageQueueBackend

async def main():
    backend = KafkaMessageQueueBackend.from_env()
    await backend.publish("demo-topic", {"hello": "world"})
    async for msg in backend.consume(group="g1"):
        print("received:", msg)
        break
    await backend.close()

asyncio.run(main())
```

## 3) Integration tests

### Testcontainers (Docker required)

```bash
uv run pytest -q -v -k test_publish_and_consume_roundtrip_with_testcontainers_threads test/integration_test/backend/queue/service/test_kafka.py
```

### Real cluster (SASL/SSL)

Set the environment variables:

```bash
# SASL/PLAIN
export KAFKA_IT_BOOTSTRAP_SERVERS=broker1:9092,broker2:9092
export KAFKA_IT_SECURITY_PROTOCOL=SASL_PLAINTEXT
export KAFKA_IT_SASL_MECHANISM=PLAIN
export KAFKA_IT_SASL_USERNAME=my-user
export KAFKA_IT_SASL_PASSWORD=my-pass

# SSL
export KAFKA_IT_SECURITY_PROTOCOL=SSL
export KAFKA_IT_SSL_CAFILE=/etc/ssl/ca.pem
export KAFKA_IT_SSL_CERTFILE=/etc/ssl/cert.pem
export KAFKA_IT_SSL_KEYFILE=/etc/ssl/key.pem
```

Run all integration tests:

```bash
uv run pytest -q -v test/integration_test
```

Note: If env vars are not set, SASL/SSL tests run in mocked mode verifying configuration.

## 4) Common tips

- If Testcontainers returns `PLAINTEXT://host:port`, the backend normalizes to `host:port`.
- Use `auto_offset_reset=earliest` with a fresh group to consume from offset 0.
- Ensure broker `advertised.listeners` is reachable from your client (localhost vs container network).
